<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Mihnea — Personal Site</title>
    <!-- Tailwind via Play CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React + ReactDOM UMD -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel Standalone to transpile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body class="min-h-dvh bg-neutral-50 text-neutral-900 dark:bg-neutral-950 dark:text-neutral-50">
    <div id="root"></div>

    <script type="text/babel">
      const { useEffect, useMemo, useState } = React;

      // ---- Minimal motion/AnimatePresence shims (no-op animations) ----
      const motion = {
        div: ({ initial, animate, exit, transition, children, ...rest }) => <div {...rest}>{children}</div>
      };
      const AnimatePresence = ({ children }) => <>{children}</>;

      // ------------------ Guides Preloader ------------------
      function usePreloadedGuides() {
        const [guides, setGuides] = useState([]);
        useEffect(() => {
          async function fetchGuides() {
            try {
              // Replace <username>/<repo> + paths with your actual files.
              const guideList = [
                {
                  id: 'bucharest',
                  title: 'Bucharest',
                  type: 'link',
                  url: '/guides/bucharest.html'
                }
              ];
              const loaded = await Promise.all(guideList.map(async g => {
                if (g.type === 'pdf') {
                  // CHANGE: use raw URL directly (no blob/dataURL conversion)
                  return { id: g.id, title: g.title, type: 'pdf', data: g.url, createdAt: Date.now() };
                } else {
                  const res = await fetch(g.url);
                  if (!res.ok) throw new Error('Fetch failed: ' + g.url);
                  const text = await res.text();
                  return { id: g.id, title: g.title, type: 'md', data: text, createdAt: Date.now() };
                }
              }));
              setGuides(loaded);
            } catch (err) {
              console.error('Failed to load guides', err);
            }
          }
          fetchGuides();
        }, []);
        return [guides, setGuides];
      }

      // ------------------ Minimal Markdown Engine ------------------
      function escapeHtml(s) {
        return s.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
      }
      function applyInlineMarkdown(text) {
        let t = text;
        t = t.replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");
        t = t.replace(/\*(.*?)\*/g, "<em>$1</em>");
        t = t.replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank" rel="noreferrer">$1</a>');
        return t;
      }
      function renderMarkdownToHtml(content) {
        const raw = content ?? "";
        const blocks = raw.split(/\n{2,}/);
        const rendered = blocks.map((block) => {
          const trimmed = block.trim();
          const headingMatch = trimmed.match(/^(#{1,6})\s+(.*)$/);
          if (headingMatch && !trimmed.includes("\n")) {
            const level = headingMatch[1].length;
            let inner = escapeHtml(headingMatch[2]);
            inner = applyInlineMarkdown(inner);
            return `<h${level}>${inner}</h${level}>`;
          }
          let inner = escapeHtml(block);
          inner = applyInlineMarkdown(inner);
          inner = inner.replace(/\n/g, "<br/>");
          return `<p>${inner}</p>`;
        });
        return rendered.join("");
      }
      function MarkdownRenderer({ content }) {
        const html = useMemo(() => renderMarkdownToHtml(content), [content]);
        return (
          <div
            className="prose prose-neutral dark:prose-invert max-w-none"
            dangerouslySetInnerHTML={{ __html: html }}
          />
        );
      }

      // ------------------ UI ------------------
      function GuideCard({ guide, onOpen }) {
        const handleClick = () => {
          if (guide.type === 'link') {
            window.location.href = guide.url; // go to subpage
          } else {
            onOpen(guide.id); // keep current preview behavior for others
          }
        };
      
        return (
          <div
            className="rounded-xl border border-neutral-200 dark:border-neutral-800 p-4 flex items-center justify-between gap-4 cursor-pointer"
            onClick={handleClick}
          >
            <div className="min-w-0">
              <div className="font-medium truncate">{guide.title}</div>
              <div className="text-xs text-neutral-500 truncate">
                {guide.type.toUpperCase()} • {new Date(guide.createdAt).toLocaleString()}
              </div>
            </div>
          </div>
        );
      }


      function Guides() {
        const [guides] = usePreloadedGuides();
        const [activeId, setActiveId] = useState(null);
        const activeGuide = useMemo(
          () => guides.find((g) => g.id === activeId) || null,
          [guides, activeId]
        );
        function onOpen(id) { setActiveId(id); }
        const showSeed = guides.length === 0;
        return (
          <div className="px-4 sm:px-6 py-8">
            <div className="flex items-center justify-between gap-4">
              <div>
                <h2 className="text-2xl md:text-3xl font-bold tracking-tight">Guides</h2>
                <p className="text-neutral-600 dark:text-neutral-400 mt-1">
                  Preloaded guides from GitHub repository.
                </p>
              </div>
            </div>
            <div className="mt-6 grid gap-4">
              {showSeed ? (
                <div className="rounded-xl border border-dashed border-neutral-300 dark:border-neutral-700 p-6 text-sm text-neutral-600 dark:text-neutral-400">
                  No guides found.
                </div>
              ) : (
                guides.map((g) => (
                  <GuideCard key={g.id} guide={g} onOpen={onOpen} />
                ))
              )}
            </div>
            <AnimatePresence>
              {activeGuide && (
                <motion.div
                  key={activeGuide.id}
                  initial={{ opacity: 0, y: 8 }}
                  animate={{ opacity: 1, y: 0 }}
                  exit={{ opacity: 0, y: 8 }}
                  transition={{ duration: 0.2 }}
                  className="mt-8 rounded-2xl border border-neutral-200 dark:border-neutral-800 overflow-hidden"
                >
                  <div className="flex items-center justify-between px-4 py-3 border-b border-neutral-200 dark:border-neutral-800 bg-neutral-50/60 dark:bg-neutral-900/60">
                    <div className="font-semibold truncate">{activeGuide.title}</div>
                    <div className="text-xs text-neutral-500">Preview</div>
                  </div>
                  <div className="bg-white dark:bg-neutral-950">
                    {activeGuide.type === "pdf" ? (
                      <iframe src={activeGuide.data} className="w-full h-[70vh]" />
                    ) : (
                      <div className="p-6">
                        <MarkdownRenderer content={activeGuide.data} />
                      </div>
                    )}
                  </div>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        );
      }

      function About() {
        return (
          <div className="px-4 sm:px-6 py-8">
            <div className="rounded-2xl border border-neutral-200 dark:border-neutral-800 p-6 bg-white dark:bg-neutral-900">
              <div className="flex items-start gap-5">
                <div className="h-16 w-16 rounded-2xl bg-black/90 dark:bg:white/90 flex items-center justify-center text-white dark:text-black text-2xl font-bold">M</div>
                <div className="min-w-0 flex-1">
                  <h1 className="text-2xl md:text-3xl font-bold tracking-tight">Hi, I’m Mihnea.</h1>
                  <p className="mt-3 text-neutral-700 dark:text-neutral-300 leading-relaxed">I’m Mihnea — a Yale undergrad exploring investing, projects, and ideas. I like building small tools and writing practical guides.</p>
                </div>
              </div>
            </div>
            <div className="mt-6 grid gap-4 md:grid-cols-2">
              <div className="rounded-2xl border border-neutral-200 dark:border-neutral-800 p-5 bg-white dark:bg-neutral-900">
                <h2 className="font-semibold">What I’m into</h2>
                <ul className="mt-3 space-y-2 text-sm text-neutral-600 dark:text-neutral-400">
                  <li>• Fundamental investing & case studies</li>
                  <li>• Building small, useful software</li>
                  <li>• Practical travel guides (Bucharest, more soon)</li>
                </ul>
              </div>
              <div className="rounded-2xl border border-neutral-200 dark:border-neutral-800 p-5 bg-white dark:bg-neutral-900">
                <h2 className="font-semibold">Quick links</h2>
                <ul className="mt-3 space-y-2 text-sm">
                  <li><a className="underline opacity-90 hover:opacity-100" href="#" onClick={(e) => e.preventDefault()}>LinkedIn</a></li>
                  <li><a className="underline opacity-90 hover:opacity-100" href="#" onClick={(e) => e.preventDefault()}>GitHub</a></li>
                </ul>
              </div>
            </div>
          </div>
        );
      }

      function App() {
        const [tab, setTab] = useState("about");
        function classNames(...xs) { return xs.filter(Boolean).join(" "); }
        return (
          <div className="min-h-dvh">
            <div className="mx-auto max-w-6xl grid grid-cols-1 md:grid-cols-[260px_minmax(0,1fr)] gap-0">
              <aside className="md:sticky md:top-0 h-full md:h-dvh border-b md:border-b-0 md:border-r border-neutral-200 dark:border-neutral-800 bg-white/70 dark:bg-neutral-900/60 backdrop-blur p-5">
                <div className="flex items-center gap-3">
                  <div className="h-10 w-10 rounded-2xl bg-black/90 dark:bg:white/90 flex items-center justify-center text-white dark:text-black font-bold">M</div>
                  <div className="min-w-0">
                    <div className="font-semibold leading-tight truncate">Mihnea</div>
                    <div className="text-xs text-neutral-500 truncate">Personal site</div>
                  </div>
                </div>
                <div className="mt-6 grid gap-2">
                  <button onClick={() => setTab("about")} className={classNames("w-full text-left px-3 py-2 rounded-xl text-sm transition-colors",
                    tab === "about" ? "bg-black text-white dark:bg-white dark:text-black" : "hover:bg-neutral-100 dark:hover:bg-neutral-800 text-neutral-700 dark:text-neutral-200")}>About</button>
                  <button onClick={() => setTab("guides")} className={classNames("w-full text-left px-3 py-2 rounded-xl text-sm transition-colors",
                    tab === "guides" ? "bg-black text-white dark:bg-white dark:text-black" : "hover:bg-neutral-100 dark:hover:bg-neutral-800 text-neutral-700 dark:text-neutral-200")}>Guides</button>
                </div>
                <div className="mt-6 text-xs text-neutral-500">© {new Date().getFullYear()} Mihnea</div>
              </aside>

              <main>
                <AnimatePresence>
                  {tab === "about" ? (
                    <motion.div key="about" initial={{ opacity: 0, y: 8 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 8 }}>
                      <About />
                    </motion.div>
                  ) : (
                    <motion.div key="guides" initial={{ opacity: 0, y: 8 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 8 }}>
                      <Guides />
                    </motion.div>
                  )}
                </AnimatePresence>
              </main>
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
